(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,n,o,r,c){var a=e.querySelector(".card").cloneNode(!0);a.querySelector(".card__title").textContent=t.name;var i=a.querySelector(".card__image"),u=a.querySelector(".card__likes");a.setAttribute("id",t._id),a.setAttribute("owner_id",t.owner._id),i.src=t.link,i.alt=t.name,u.textContent=t.likes.length;var l=a.querySelector(".card__delete-button"),s=a.querySelector(".card__like-button");return l.addEventListener("click",o),n!==t.owner._id&&l.remove(),t.likes.forEach((function(e){e._id===n&&s.classList.add("card__like-button_is-active")})),i.addEventListener("click",(function(){c(t)})),s.addEventListener("click",r),a}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function o(e){e.classList.add("popup_opened");for(var t=function(e){if(Array.isArray(e))return n(e)}(r=document.querySelector(".popup_opened").querySelectorAll("input"))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(e,t):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),o=0;o<t.length;o++)console.log(t[o].value),t[o].value="";var r;document.addEventListener("keydown",c)}function r(e){e.classList.add("popup_closed"),setTimeout((function(){return e.classList.remove("popup_opened")}),300),setTimeout((function(){return e.classList.remove("popup_closed")}),300),document.removeEventListener("keydown",c)}function c(e){"Escape"===e.key&&r(document.querySelector(".popup_opened"))}var a=document.forms.editProfile,i=document.querySelector(".profile__title"),u=document.querySelector(".profile__description");a.name.value=i.textContent,a.description.value=u.textContent;var l={baseUrl:"https://nomoreparties.co/v1/cohort-magistr-2",headers:{authorization:"db2f39af-180e-4eb9-8615-3688481eaf22","Content-Type":"application/json"}},s=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function d(e,t,n,o){console.warn("hideInputError");var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}var p=document.querySelector(".profile__title"),f=document.querySelector(".profile__description"),m=document.forms.editProfile,_=m.querySelector(".button"),v=document.querySelector(".popup_type_image"),y=document.querySelector(".popup__image"),h=document.querySelector(".popup__caption"),b=document.forms.newPlace,S=document.forms.newPlace,g=S.querySelector(".popup__button"),q=document.querySelector(".profile__image"),C=document.querySelector(".profile__title"),k=document.querySelector(".places__list"),L=document.querySelector(".profile__description"),E=b.elements.placeName,x=b.elements.imageSrc,A=document.querySelector(".popup_type_update-avatar"),w=document.forms["change-avatar"],P=w.querySelector(".popup__button"),U=document.forms.editProfile,T=document.querySelector(".profile__edit-button"),j=U.elements.name,D=U.elements.description,O=document.querySelector(".popup_type_edit"),B="",I="";function N(e){var t;e.preventDefault(),P.textContent="Сохранение...",(t=w.avatar.value,fetch("".concat(l.baseUrl,"/users/me/avatar "),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})}).then((function(e){return s(e)}))).then((function(e){q.removeAttribute("style"),q.setAttribute("style","background-image:url(".concat(e.avatar,")")),r(A)})).catch((function(e){console.log(e)})).finally((function(){P.textContent="Сохранить"}))}function J(e){o(v),y.src=e.link,y.alt=e.name,h.textContent=e.name}function M(e){var t,n=e.target.closest(".card"),o=n.querySelector(".card__likes");e.target.closest(".card__like-button_is-active")?(console.log("id:",n._id),(t=n.id,fetch("".concat(l.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:l.headers}).then((function(e){return s(e)}))).then((function(t){console.log("LIKE",t),o.textContent=t.likes.length,e.target.classList.toggle("card__like-button_is-active")})).catch((function(e){console.log(e)})).finally((function(){}))):function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers}).then((function(e){return s(e)}))}(n.id).then((function(t){console.log("LIKE",t),o.textContent=t.likes.length,e.target.classList.toggle("card__like-button_is-active"),console.log(t)})).catch((function(e){console.log(e)}))}function H(e){var t;e.preventDefault(),(t=e.target.closest(".card").id,fetch("".concat(l.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:l.headers,body:JSON.stringify({_id:t})}).then((function(e){return s(e)}))).then((function(){e.target.closest(".card").remove()})).catch((function(e){console.log(e)}))}T.addEventListener("click",(function(){j.value=C.textContent,D.value=L.textContent,o(O)})),q.addEventListener("click",(function(){w.reset(),function(e,t){var n=e.querySelectorAll(t.inputSelector),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){d(e,n,t.inputErrorClass,t.errorClass)})),o.disabled=!0,o.classList.add(t.inactiveButtonClass)}(w,R),o(A),w.addEventListener("submit",N)})),a.addEventListener("submit",(function(e){e.preventDefault(),i.textContent=a.name.value,u.textContent=a.description.value,r(document.querySelector(".popup_opened"))})),document.addEventListener("click",(function(e){e.target.classList.contains("profile__edit-button")&&o(document.querySelector(".popup_type_edit")),e.target.classList.contains("profile__add-button")&&o(document.querySelector(".popup_type_new-card")),e.target.classList.contains("popup__close")&&r(document.querySelector(".popup_opened")),e.target.classList.contains("popup_opened")&&r(e.target)})),g.classList.add("popup__button-no-active"),g.disabled="true",S.addEventListener("submit",(function(e){e.preventDefault(),g.textContent="Сохранение...";var n={name:E.value,link:x.value,likes:[]};n.owner={_id:B},function(e){return fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return s(e)}))}(n).then((function(n){k.prepend(t(n,B,H,M,J)),b.reset(),r(e.target.closest(".popup"))})).catch((function(e){console.log(e)})).finally((function(){g.textContent="Сохранить"}))}));var K,V,z,$,F,G,Q,R={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button-no-active",inputErrorClass:"popup__input-error",errorClass:"popup__text-error-active"};m.addEventListener("submit",(function(e){var t,n;e.preventDefault(),_.textContent="Сохранение...",(t=m.name.value,n=m.description.value,fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.json()}))).then((function(){console.log("ok"),p.textContent=m.name.value,f.textContent=m.description.value,closePopup(popupEditProfile)})).catch((function(e){console.log(e)})).finally((function(){_.textContent="Сохранить"}))})),V=(K=R).formSelector,z=K.inputSelector,$=K.submitButtonSelector,F=K.inactiveButtonClass,G=K.inputErrorClass,Q=K.errorClass,Array.from(document.querySelectorAll(V)).forEach((function(e){!function(e,t,n,o,r,c){var a=Array.from(e.querySelectorAll(t)),i=e.querySelector(n);a.forEach((function(t){t.addEventListener("input",(function(){(function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?d(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)})(e,t,r,c),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))}(a,i,o)}))}))}(e,z,$,F,G,Q)})),Promise.all([fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then((function(e){return s(e)})),fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then((function(e){return s(e)}))]).then((function(e){console.log(e),C.textContent=e[0].name,L.textContent=e[0].about,B=e[0]._id,I=e[0].avatar,q.setAttribute("style","background-image:url(".concat(I,")")),e[1].forEach((function(e){var n={name:e.name,link:e.link,likes:e.likes,_id:e._id,owner:{_id:e.owner._id}};k.append(t(n,B,H,M,J))}))})).catch((function(e){console.log("Ошибка: "+e)}))})();